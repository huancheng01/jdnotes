# æ—¥å†è§†å›¾åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸º JD Notes æ·»åŠ æ—¥å†è§†å›¾åŠŸèƒ½ï¼Œè®©ç”¨æˆ·èƒ½å¤ŸæŒ‰æ—¥æœŸæŸ¥çœ‹å’Œç®¡ç†ç¬”è®°ï¼Œæä¾›æ—¶é—´ç»´åº¦çš„ç¬”è®°ç»„ç»‡æ–¹å¼ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ—¥å†è§†å›¾æ¨¡å¼
- **æœˆè§†å›¾**ï¼šæ˜¾ç¤ºæ•´æœˆçš„ç¬”è®°åˆ†å¸ƒï¼Œæ¯å¤©æ˜¾ç¤ºç¬”è®°æ•°é‡
- **å‘¨è§†å›¾**ï¼šæ˜¾ç¤ºä¸€å‘¨çš„è¯¦ç»†ç¬”è®°åˆ—è¡¨
- **æ—¥è§†å›¾**ï¼šæ˜¾ç¤ºå•æ—¥çš„æ‰€æœ‰ç¬”è®°è¯¦æƒ…

### 2. ç¬”è®°æ—¶é—´ç»´åº¦
- åŸºäº `createdAt`ï¼ˆåˆ›å»ºæ—¶é—´ï¼‰æ˜¾ç¤ºç¬”è®°
- å¯é€‰åˆ‡æ¢åˆ° `updatedAt`ï¼ˆä¿®æ”¹æ—¶é—´ï¼‰
- æ”¯æŒå¿«é€Ÿè·³è½¬åˆ°ä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆ

### 3. äº¤äº’åŠŸèƒ½
- ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹å½“å¤©çš„ç¬”è®°åˆ—è¡¨
- æ—¥å†æ ¼å­æ˜¾ç¤ºç¬”è®°æ•°é‡å¾½ç« 
- æ”¯æŒåœ¨æ—¥å†è§†å›¾ä¸­ç›´æ¥åˆ›å»ºç¬”è®°ï¼ˆè‡ªåŠ¨è®¾ç½®æ—¥æœŸï¼‰
- æ‹–æ‹½ç¬”è®°åˆ°ä¸åŒæ—¥æœŸï¼ˆå¯é€‰é«˜çº§åŠŸèƒ½ï¼‰

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•°æ®å±‚

#### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
å½“å‰ `Note` æ¥å£å·²åŒ…å«æ‰€éœ€å­—æ®µï¼š
```typescript
interface Note {
  id: number
  title: string
  content: string
  tags: string[]
  isFavorite: number
  isDeleted: number
  createdAt: Date      // âœ… å·²æœ‰
  updatedAt: Date      // âœ… å·²æœ‰
}
```

**æ–°å¢æŸ¥è¯¢æ–¹æ³•**ï¼ˆåœ¨ `src/lib/db.ts` ä¸­ï¼‰ï¼š
```typescript
export const noteOperations = {
  // ... ç°æœ‰æ–¹æ³•
  
  // è·å–æŒ‡å®šæ—¥æœŸèŒƒå›´çš„ç¬”è®°
  async getByDateRange(
    startDate: Date, 
    endDate: Date, 
    dateField: 'createdAt' | 'updatedAt' = 'createdAt'
  ): Promise<Note[]> {
    return await db.notes
      .where(dateField)
      .between(startDate, endDate, true, true)
      .and(note => note.isDeleted === 0)
      .sortBy(dateField)
  },
  
  // è·å–æŒ‡å®šæ—¥æœŸçš„ç¬”è®°
  async getByDate(
    date: Date, 
    dateField: 'createdAt' | 'updatedAt' = 'createdAt'
  ): Promise<Note[]> {
    const startOfDay = new Date(date)
    startOfDay.setHours(0, 0, 0, 0)
    
    const endOfDay = new Date(date)
    endOfDay.setHours(23, 59, 59, 999)
    
    return this.getByDateRange(startOfDay, endOfDay, dateField)
  },
  
  // è·å–ç¬”è®°çš„æ—¥æœŸåˆ†å¸ƒç»Ÿè®¡
  async getDateDistribution(
    startDate: Date,
    endDate: Date,
    dateField: 'createdAt' | 'updatedAt' = 'createdAt'
  ): Promise<Map<string, number>> {
    const notes = await this.getByDateRange(startDate, endDate, dateField)
    const distribution = new Map<string, number>()
    
    notes.forEach(note => {
      const dateKey = formatDateKey(note[dateField])
      distribution.set(dateKey, (distribution.get(dateKey) || 0) + 1)
    })
    
    return distribution
  }
}

// è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸä¸º YYYY-MM-DD
function formatDateKey(date: Date): string {
  return date.toISOString().split('T')[0]
}
```

#### 2. è‡ªå®šä¹‰ Hook
åˆ›å»º `src/hooks/useCalendar.ts`ï¼š
```typescript
import { useState, useMemo, useCallback } from 'react'
import { useLiveQuery } from 'dexie-react-hooks'
import { db, noteOperations } from '../lib/db'

export type CalendarView = 'month' | 'week' | 'day'
export type DateField = 'createdAt' | 'updatedAt'

export function useCalendar() {
  const [currentDate, setCurrentDate] = useState(new Date())
  const [view, setView] = useState<CalendarView>('month')
  const [dateField, setDateField] = useState<DateField>('createdAt')
  
  // è®¡ç®—æ—¥æœŸèŒƒå›´
  const dateRange = useMemo(() => {
    const start = new Date(currentDate)
    const end = new Date(currentDate)
    
    switch (view) {
      case 'month':
        start.setDate(1)
        start.setHours(0, 0, 0, 0)
        end.setMonth(end.getMonth() + 1, 0)
        end.setHours(23, 59, 59, 999)
        break
      case 'week':
        const day = start.getDay()
        start.setDate(start.getDate() - day)
        start.setHours(0, 0, 0, 0)
        end.setDate(start.getDate() + 6)
        end.setHours(23, 59, 59, 999)
        break
      case 'day':
        start.setHours(0, 0, 0, 0)
        end.setHours(23, 59, 59, 999)
        break
    }
    
    return { start, end }
  }, [currentDate, view])
  
  // å®æ—¶æŸ¥è¯¢ç¬”è®°
  const notes = useLiveQuery(
    async () => {
      return await noteOperations.getByDateRange(
        dateRange.start,
        dateRange.end,
        dateField
      )
    },
    [dateRange.start, dateRange.end, dateField]
  )
  
  // è®¡ç®—æ—¥æœŸåˆ†å¸ƒ
  const distribution = useMemo(() => {
    if (!notes) return new Map()
    
    const map = new Map<string, number>()
    notes.forEach(note => {
      const date = note[dateField]
      const key = date.toISOString().split('T')[0]
      map.set(key, (map.get(key) || 0) + 1)
    })
    
    return map
  }, [notes, dateField])
  
  // å¯¼èˆªæ–¹æ³•
  const goToToday = useCallback(() => {
    setCurrentDate(new Date())
  }, [])
  
  const goToPrevious = useCallback(() => {
    const newDate = new Date(currentDate)
    switch (view) {
      case 'month':
        newDate.setMonth(newDate.getMonth() - 1)
        break
      case 'week':
        newDate.setDate(newDate.getDate() - 7)
        break
      case 'day':
        newDate.setDate(newDate.getDate() - 1)
        break
    }
    setCurrentDate(newDate)
  }, [currentDate, view])
  
  const goToNext = useCallback(() => {
    const newDate = new Date(currentDate)
    switch (view) {
      case 'month':
        newDate.setMonth(newDate.getMonth() + 1)
        break
      case 'week':
        newDate.setDate(newDate.getDate() + 7)
        break
      case 'day':
        newDate.setDate(newDate.getDate() + 1)
        break
    }
    setCurrentDate(newDate)
  }, [currentDate, view])
  
  const goToDate = useCallback((date: Date) => {
    setCurrentDate(date)
  }, [])
  
  return {
    currentDate,
    view,
    dateField,
    notes,
    distribution,
    dateRange,
    setView,
    setDateField,
    goToToday,
    goToPrevious,
    goToNext,
    goToDate,
  }
}
```

---

## ğŸ¨ UI ç»„ä»¶è®¾è®¡

### ç»„ä»¶ç»“æ„

```
src/components/calendar/
â”œâ”€â”€ CalendarView.tsx          # ä¸»å®¹å™¨ç»„ä»¶
â”œâ”€â”€ CalendarHeader.tsx        # é¡¶éƒ¨å¯¼èˆªæ 
â”œâ”€â”€ MonthView.tsx            # æœˆè§†å›¾
â”œâ”€â”€ WeekView.tsx             # å‘¨è§†å›¾
â”œâ”€â”€ DayView.tsx              # æ—¥è§†å›¾
â”œâ”€â”€ CalendarGrid.tsx         # æ—¥å†ç½‘æ ¼
â”œâ”€â”€ CalendarCell.tsx         # å•ä¸ªæ—¥æœŸæ ¼å­
â””â”€â”€ index.ts                 # å¯¼å‡º
```

### 1. CalendarView ä¸»ç»„ä»¶

```typescript
// src/components/calendar/CalendarView.tsx
import { useState } from 'react'
import { useCalendar } from '../../hooks/useCalendar'
import { CalendarHeader } from './CalendarHeader'
import { MonthView } from './MonthView'
import { WeekView } from './WeekView'
import { DayView } from './DayView'
import type { Note } from '../../lib/db'

interface CalendarViewProps {
  onSelectNote: (note: Note) => void
  onCreateNote: (date?: Date) => void
}

export function CalendarView({ onSelectNote, onCreateNote }: CalendarViewProps) {
  const calendar = useCalendar()
  
  return (
    <div className="h-full flex flex-col bg-[#F9FBFC] dark:bg-[#0B0D11]">
      <CalendarHeader
        currentDate={calendar.currentDate}
        view={calendar.view}
        dateField={calendar.dateField}
        onViewChange={calendar.setView}
        onDateFieldChange={calendar.setDateField}
        onPrevious={calendar.goToPrevious}
        onNext={calendar.goToNext}
        onToday={calendar.goToToday}
      />
      
      <div className="flex-1 overflow-auto">
        {calendar.view === 'month' && (
          <MonthView
            currentDate={calendar.currentDate}
            notes={calendar.notes || []}
            distribution={calendar.distribution}
            onSelectDate={calendar.goToDate}
            onSelectNote={onSelectNote}
            onCreateNote={onCreateNote}
          />
        )}
        
        {calendar.view === 'week' && (
          <WeekView
            currentDate={calendar.currentDate}
            notes={calendar.notes || []}
            onSelectNote={onSelectNote}
            onCreateNote={onCreateNote}
          />
        )}
        
        {calendar.view === 'day' && (
          <DayView
            currentDate={calendar.currentDate}
            notes={calendar.notes || []}
            onSelectNote={onSelectNote}
            onCreateNote={onCreateNote}
          />
        )}
      </div>
    </div>
  )
}
```

### 2. CalendarHeader å¯¼èˆªæ 

```typescript
// src/components/calendar/CalendarHeader.tsx
import { ChevronLeft, ChevronRight, Calendar } from 'lucide-react'
import type { CalendarView, DateField } from '../../hooks/useCalendar'

interface CalendarHeaderProps {
  currentDate: Date
  view: CalendarView
  dateField: DateField
  onViewChange: (view: CalendarView) => void
  onDateFieldChange: (field: DateField) => void
  onPrevious: () => void
  onNext: () => void
  onToday: () => void
}

export function CalendarHeader({
  currentDate,
  view,
  dateField,
  onViewChange,
  onDateFieldChange,
  onPrevious,
  onNext,
  onToday,
}: CalendarHeaderProps) {
  const formatTitle = () => {
    const year = currentDate.getFullYear()
    const month = currentDate.getMonth() + 1
    
    switch (view) {
      case 'month':
        return `${year}å¹´${month}æœˆ`
      case 'week':
        return `${year}å¹´ç¬¬${getWeekNumber(currentDate)}å‘¨`
      case 'day':
        return `${year}å¹´${month}æœˆ${currentDate.getDate()}æ—¥`
    }
  }
  
  return (
    <div className="px-6 py-4 border-b border-black/[0.03] dark:border-white/[0.06]">
      <div className="flex items-center justify-between">
        {/* å·¦ä¾§ï¼šæ ‡é¢˜å’Œå¯¼èˆª */}
        <div className="flex items-center gap-3">
          <Calendar className="h-5 w-5 text-slate-400" strokeWidth={1.5} />
          <h2 className="text-lg font-semibold text-slate-900 dark:text-slate-100">
            {formatTitle()}
          </h2>
          
          <div className="flex items-center gap-1 ml-2">
            <button
              onClick={onPrevious}
              className="p-1.5 rounded-lg text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-black/[0.03] dark:hover:bg-white/[0.06] transition-colors"
            >
              <ChevronLeft className="h-4 w-4" strokeWidth={1.5} />
            </button>
            <button
              onClick={onNext}
              className="p-1.5 rounded-lg text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-black/[0.03] dark:hover:bg-white/[0.06] transition-colors"
            >
              <ChevronRight className="h-4 w-4" strokeWidth={1.5} />
            </button>
            <button
              onClick={onToday}
              className="ml-2 px-3 py-1.5 text-[13px] font-medium text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-black/[0.03] dark:hover:bg-white/[0.06] rounded-lg transition-colors"
            >
              ä»Šå¤©
            </button>
          </div>
        </div>
        
        {/* å³ä¾§ï¼šè§†å›¾åˆ‡æ¢å’Œæ—¶é—´å­—æ®µé€‰æ‹© */}
        <div className="flex items-center gap-2">
          {/* æ—¶é—´å­—æ®µåˆ‡æ¢ */}
          <div className="flex items-center gap-1 bg-white/50 dark:bg-white/[0.03] rounded-lg p-1">
            <button
              onClick={() => onDateFieldChange('createdAt')}
              className={`px-3 py-1.5 text-[13px] font-medium rounded-md transition-colors ${
                dateField === 'createdAt'
                  ? 'bg-white dark:bg-white/[0.06] text-slate-900 dark:text-slate-100 shadow-sm'
                  : 'text-slate-500 hover:text-slate-900 dark:hover:text-slate-100'
              }`}
            >
              åˆ›å»ºæ—¶é—´
            </button>
            <button
              onClick={() => onDateFieldChange('updatedAt')}
              className={`px-3 py-1.5 text-[13px] font-medium rounded-md transition-colors ${
                dateField === 'updatedAt'
                  ? 'bg-white dark:bg-white/[0.06] text-slate-900 dark:text-slate-100 shadow-sm'
                  : 'text-slate-500 hover:text-slate-900 dark:hover:text-slate-100'
              }`}
            >
              ä¿®æ”¹æ—¶é—´
            </button>
          </div>
          
          {/* è§†å›¾åˆ‡æ¢ */}
          <div className="flex items-center gap-1 bg-white/50 dark:bg-white/[0.03] rounded-lg p-1">
            <button
              onClick={() => onViewChange('month')}
              className={`px-3 py-1.5 text-[13px] font-medium rounded-md transition-colors ${
                view === 'month'
                  ? 'bg-white dark:bg-white/[0.06] text-slate-900 dark:text-slate-100 shadow-sm'
                  : 'text-slate-500 hover:text-slate-900 dark:hover:text-slate-100'
              }`}
            >
              æœˆ
            </button>
            <button
              onClick={() => onViewChange('week')}
              className={`px-3 py-1.5 text-[13px] font-medium rounded-md transition-colors ${
                view === 'week'
                  ? 'bg-white dark:bg-white/[0.06] text-slate-900 dark:text-slate-100 shadow-sm'
                  : 'text-slate-500 hover:text-slate-900 dark:hover:text-slate-100'
              }`}
            >
              å‘¨
            </button>
            <button
              onClick={() => onViewChange('day')}
              className={`px-3 py-1.5 text-[13px] font-medium rounded-md transition-colors ${
                view === 'day'
                  ? 'bg-white dark:bg-white/[0.06] text-slate-900 dark:text-slate-100 shadow-sm'
                  : 'text-slate-500 hover:text-slate-900 dark:hover:text-slate-100'
              }`}
            >
              æ—¥
            </button>
          </div>
        </div>
      </div>
    </div>
  )
}

function getWeekNumber(date: Date): number {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()))
  const dayNum = d.getUTCDay() || 7
  d.setUTCDate(d.getUTCDate() + 4 - dayNum)
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1))
  return Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7)
}
```

### 3. MonthView æœˆè§†å›¾

```typescript
// src/components/calendar/MonthView.tsx
import { useMemo } from 'react'
import { CalendarCell } from './CalendarCell'
import type { Note } from '../../lib/db'

interface MonthViewProps {
  currentDate: Date
  notes: Note[]
  distribution: Map<string, number>
  onSelectDate: (date: Date) => void
  onSelectNote: (note: Note) => void
  onCreateNote: (date?: Date) => void
}

export function MonthView({
  currentDate,
  notes,
  distribution,
  onSelectDate,
  onSelectNote,
  onCreateNote,
}: MonthViewProps) {
  // ç”Ÿæˆæ—¥å†ç½‘æ ¼æ•°æ®
  const calendarDays = useMemo(() => {
    const year = currentDate.getFullYear()
    const month = currentDate.getMonth()
    
    // å½“æœˆç¬¬ä¸€å¤©
    const firstDay = new Date(year, month, 1)
    const firstDayOfWeek = firstDay.getDay()
    
    // å½“æœˆæœ€åä¸€å¤©
    const lastDay = new Date(year, month + 1, 0)
    const daysInMonth = lastDay.getDate()
    
    // ä¸Šæœˆéœ€è¦æ˜¾ç¤ºçš„å¤©æ•°
    const prevMonthDays = firstDayOfWeek
    const prevMonth = new Date(year, month, 0)
    const prevMonthLastDay = prevMonth.getDate()
    
    // ä¸‹æœˆéœ€è¦æ˜¾ç¤ºçš„å¤©æ•°
    const totalCells = 42 // 6å‘¨ x 7å¤©
    const nextMonthDays = totalCells - prevMonthDays - daysInMonth
    
    const days: Array<{
      date: Date
      isCurrentMonth: boolean
      isToday: boolean
      noteCount: number
    }> = []
    
    const today = new Date()
    today.setHours(0, 0, 0, 0)
    
    // ä¸Šæœˆ
    for (let i = prevMonthDays - 1; i >= 0; i--) {
      const date = new Date(year, month - 1, prevMonthLastDay - i)
      days.push({
        date,
        isCurrentMonth: false,
        isToday: date.getTime() === today.getTime(),
        noteCount: distribution.get(formatDateKey(date)) || 0,
      })
    }
    
    // å½“æœˆ
    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month, i)
      days.push({
        date,
        isCurrentMonth: true,
        isToday: date.getTime() === today.getTime(),
        noteCount: distribution.get(formatDateKey(date)) || 0,
      })
    }
    
    // ä¸‹æœˆ
    for (let i = 1; i <= nextMonthDays; i++) {
      const date = new Date(year, month + 1, i)
      days.push({
        date,
        isCurrentMonth: false,
        isToday: date.getTime() === today.getTime(),
        noteCount: distribution.get(formatDateKey(date)) || 0,
      })
    }
    
    return days
  }, [currentDate, distribution])
  
  return (
    <div className="p-6">
      {/* æ˜ŸæœŸæ ‡é¢˜ */}
      <div className="grid grid-cols-7 gap-2 mb-2">
        {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map((day) => (
          <div
            key={day}
            className="text-center text-[13px] font-medium text-slate-400 py-2"
          >
            {day}
          </div>
        ))}
      </div>
      
      {/* æ—¥å†ç½‘æ ¼ */}
      <div className="grid grid-cols-7 gap-2">
        {calendarDays.map((day, index) => (
          <CalendarCell
            key={index}
            date={day.date}
            isCurrentMonth={day.isCurrentMonth}
            isToday={day.isToday}
            noteCount={day.noteCount}
            onClick={() => onSelectDate(day.date)}
            onCreateNote={() => onCreateNote(day.date)}
          />
        ))}
      </div>
    </div>
  )
}

function formatDateKey(date: Date): string {
  return date.toISOString().split('T')[0]
}
```

### 4. CalendarCell æ—¥æœŸæ ¼å­

```typescript
// src/components/calendar/CalendarCell.tsx
import { Plus } from 'lucide-react'

interface CalendarCellProps {
  date: Date
  isCurrentMonth: boolean
  isToday: boolean
  noteCount: number
  onClick: () => void
  onCreateNote: () => void
}

export function CalendarCell({
  date,
  isCurrentMonth,
  isToday,
  noteCount,
  onClick,
  onCreateNote,
}: CalendarCellProps) {
  return (
    <div
      className={`
        group relative aspect-square rounded-xl border transition-all cursor-pointer
        ${isCurrentMonth 
          ? 'bg-white dark:bg-white/[0.03] border-black/[0.06] dark:border-white/[0.06]' 
          : 'bg-slate-50 dark:bg-white/[0.01] border-transparent'
        }
        ${isToday 
          ? 'ring-2 ring-[#5E6AD2] ring-offset-2 dark:ring-offset-[#0B0D11]' 
          : ''
        }
        hover:border-[#5E6AD2]/30 hover:shadow-sm
      `}
      onClick={onClick}
    >
      {/* æ—¥æœŸæ•°å­— */}
      <div className="absolute top-2 left-2">
        <span
          className={`
            text-sm font-medium
            ${isCurrentMonth 
              ? 'text-slate-900 dark:text-slate-100' 
              : 'text-slate-400 dark:text-slate-600'
            }
            ${isToday ? 'text-[#5E6AD2]' : ''}
          `}
        >
          {date.getDate()}
        </span>
      </div>
      
      {/* ç¬”è®°æ•°é‡å¾½ç«  */}
      {noteCount > 0 && (
        <div className="absolute top-2 right-2">
          <span className="inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-[11px] font-medium text-white bg-[#5E6AD2] rounded-full">
            {noteCount}
          </span>
        </div>
      )}
      
      {/* å¿«é€Ÿåˆ›å»ºæŒ‰é’®ï¼ˆhoveræ˜¾ç¤ºï¼‰ */}
      {isCurrentMonth && (
        <button
          onClick={(e) => {
            e.stopPropagation()
            onCreateNote()
          }}
          className="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded-md bg-[#5E6AD2]/10 hover:bg-[#5E6AD2]/20 text-[#5E6AD2]"
          title="åˆ›å»ºç¬”è®°"
        >
          <Plus className="h-3 w-3" strokeWidth={2} />
        </button>
      )}
      
      {/* ç¬”è®°æŒ‡ç¤ºç‚¹ï¼ˆæœ€å¤šæ˜¾ç¤º3ä¸ªï¼‰ */}
      {noteCount > 0 && noteCount <= 3 && (
        <div className="absolute bottom-2 left-2 flex gap-1">
          {Array.from({ length: Math.min(noteCount, 3) }).map((_, i) => (
            <div
              key={i}
              className="w-1.5 h-1.5 rounded-full bg-[#5E6AD2]/60"
            />
          ))}
        </div>
      )}
    </div>
  )
}
```

### 5. WeekView å‘¨è§†å›¾

```typescript
// src/components/calendar/WeekView.tsx
import { useMemo } from 'react'
import { formatTime } from '../../lib/utils'
import type { Note } from '../../lib/db'

interface WeekViewProps {
  currentDate: Date
  notes: Note[]
  onSelectNote: (note: Note) => void
  onCreateNote: (date?: Date) => void
}

export function WeekView({
  currentDate,
  notes,
  onSelectNote,
  onCreateNote,
}: WeekViewProps) {
  // ç”Ÿæˆä¸€å‘¨çš„æ—¥æœŸ
  const weekDays = useMemo(() => {
    const days: Date[] = []
    const startOfWeek = new Date(currentDate)
    const dayOfWeek = startOfWeek.getDay()
    startOfWeek.setDate(startOfWeek.getDate() - dayOfWeek)
    
    for (let i = 0; i < 7; i++) {
      const date = new Date(startOfWeek)
      date.setDate(date.getDate() + i)
      days.push(date)
    }
    
    return days
  }, [currentDate])
  
  // æŒ‰æ—¥æœŸåˆ†ç»„ç¬”è®°
  const notesByDay = useMemo(() => {
    const map = new Map<string, Note[]>()
    
    notes.forEach(note => {
      const dateKey = note.createdAt.toISOString().split('T')[0]
      if (!map.has(dateKey)) {
        map.set(dateKey, [])
      }
      map.get(dateKey)!.push(note)
    })
    
    return map
  }, [notes])
  
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  
  return (
    <div className="p-6">
      <div className="grid grid-cols-7 gap-4">
        {weekDays.map((date) => {
          const dateKey = date.toISOString().split('T')[0]
          const dayNotes = notesByDay.get(dateKey) || []
          const isToday = date.getTime() === today.getTime()
          
          return (
            <div
              key={dateKey}
              className={`
                rounded-xl border p-4
                ${isToday 
                  ? 'bg-[#5E6AD2]/5 border-[#5E6AD2]/30' 
                  : 'bg-white dark:bg-white/[0.03] border-black/[0.06] dark:border-white/[0.06]'
                }
              `}
            >
              {/* æ—¥æœŸæ ‡é¢˜ */}
              <div className="mb-3 pb-3 border-b border-black/[0.06] dark:border-white/[0.06]">
                <div className="text-[11px] text-slate-400 mb-1">
                  {['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][date.getDay()]}
                </div>
                <div className={`text-lg font-semibold ${isToday ? 'text-[#5E6AD2]' : 'text-slate-900 dark:text-slate-100'}`}>
                  {date.getDate()}
                </div>
              </div>
              
              {/* ç¬”è®°åˆ—è¡¨ */}
              <div className="space-y-2">
                {dayNotes.map((note) => (
                  <button
                    key={note.id}
                    onClick={() => onSelectNote(note)}
                    className="w-full text-left p-2 rounded-lg bg-slate-50 dark:bg-white/[0.03] hover:bg-slate-100 dark:hover:bg-white/[0.06] transition-colors"
                  >
                    <div className="text-[13px] font-medium text-slate-900 dark:text-slate-100 truncate">
                      {note.title || 'æ— æ ‡é¢˜'}
                    </div>
                    <div className="text-[11px] text-slate-400 mt-1">
                      {formatTime(note.createdAt)}
                    </div>
                  </button>
                ))}
                
                {/* ç©ºçŠ¶æ€ */}
                {dayNotes.length === 0 && (
                  <div className="text-[13px] text-slate-400 text-center py-4">
                    æš‚æ— ç¬”è®°
                  </div>
                )}
              </div>
              
              {/* åˆ›å»ºæŒ‰é’® */}
              <button
                onClick={() => onCreateNote(date)}
                className="w-full mt-3 py-2 text-[13px] text-slate-500 hover:text-[#5E6AD2] hover:bg-[#5E6AD2]/5 rounded-lg transition-colors"
              >
                + åˆ›å»ºç¬”è®°
              </button>
            </div>
          )
        })}
      </div>
    </div>
  )
}
```

### 6. DayView æ—¥è§†å›¾

```typescript
// src/components/calendar/DayView.tsx
import { Clock } from 'lucide-react'
import { formatTime } from '../../lib/utils'
import type { Note } from '../../lib/db'

interface DayViewProps {
  currentDate: Date
  notes: Note[]
  onSelectNote: (note: Note) => void
  onCreateNote: (date?: Date) => void
}

export function DayView({
  currentDate,
  notes,
  onSelectNote,
  onCreateNote,
}: DayViewProps) {
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  const isToday = currentDate.getTime() === today.getTime()
  
  return (
    <div className="max-w-4xl mx-auto p-6">
      {/* æ—¥æœŸæ ‡é¢˜ */}
      <div className={`mb-6 p-6 rounded-2xl border ${
        isToday
          ? 'bg-[#5E6AD2]/5 border-[#5E6AD2]/30'
          : 'bg-white dark:bg-white/[0.03] border-black/[0.06] dark:border-white/[0.06]'
      }`}>
        <div className="flex items-center justify-between">
          <div>
            <div className="text-sm text-slate-400 mb-1">
              {['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'][currentDate.getDay()]}
            </div>
            <div className={`text-3xl font-bold ${isToday ? 'text-[#5E6AD2]' : 'text-slate-900 dark:text-slate-100'}`}>
              {currentDate.getMonth() + 1}æœˆ{currentDate.getDate()}æ—¥
            </div>
          </div>
          <div className="text-right">
            <div className="text-sm text-slate-400 mb-1">å…± {notes.length} ç¯‡ç¬”è®°</div>
            <button
              onClick={() => onCreateNote(currentDate)}
              className="px-4 py-2 text-sm font-medium text-white bg-[#5E6AD2] hover:bg-[#5E6AD2]/90 rounded-lg transition-colors"
            >
              + åˆ›å»ºç¬”è®°
            </button>
          </div>
        </div>
      </div>
      
      {/* ç¬”è®°åˆ—è¡¨ */}
      {notes.length > 0 ? (
        <div className="space-y-3">
          {notes.map((note) => (
            <button
              key={note.id}
              onClick={() => onSelectNote(note)}
              className="w-full text-left p-4 rounded-xl bg-white dark:bg-white/[0.03] border border-black/[0.06] dark:border-white/[0.06] hover:border-[#5E6AD2]/30 hover:shadow-sm transition-all"
            >
              <div className="flex items-start justify-between gap-4">
                <div className="flex-1 min-w-0">
                  <h3 className="text-base font-semibold text-slate-900 dark:text-slate-100 mb-2">
                    {note.title || 'æ— æ ‡é¢˜'}
                  </h3>
                  {note.content && (
                    <p className="text-sm text-slate-500 line-clamp-2">
                      {note.content.replace(/<[^>]*>/g, '').substring(0, 150)}
                    </p>
                  )}
                  <div className="flex items-center gap-3 mt-3">
                    <div className="flex items-center gap-1 text-xs text-slate-400">
                      <Clock className="h-3 w-3" strokeWidth={1.5} />
                      {formatTime(note.createdAt)}
                    </div>
                    {note.tags && note.tags.length > 0 && (
                      <div className="flex items-center gap-1">
                        {note.tags.slice(0, 3).map((tag) => (
                          <span
                            key={tag}
                            className="px-2 py-0.5 text-xs text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-white/[0.06] rounded"
                          >
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </button>
          ))}
        </div>
      ) : (
        <div className="text-center py-12">
          <div className="text-slate-400 mb-4">è¿™ä¸€å¤©è¿˜æ²¡æœ‰ç¬”è®°</div>
          <button
            onClick={() => onCreateNote(currentDate)}
            className="px-4 py-2 text-sm font-medium text-[#5E6AD2] hover:bg-[#5E6AD2]/10 rounded-lg transition-colors"
          >
            åˆ›å»ºç¬¬ä¸€ç¯‡ç¬”è®°
          </button>
        </div>
      )}
    </div>
  )
}
```

---

## ğŸ”— é›†æˆåˆ°ç°æœ‰åº”ç”¨

### 1. æ›´æ–° App.tsx

åœ¨ [`src/App.tsx`](src/App.tsx:12) ä¸­æ·»åŠ æ—¥å†è§†å›¾æ”¯æŒï¼š

```typescript
// åœ¨ ViewType ä¸­æ·»åŠ  calendar
type ViewType = 'inbox' | 'favorites' | 'trash' | 'calendar' | `tag-${string}`

// åœ¨ App ç»„ä»¶ä¸­æ·»åŠ çŠ¶æ€
const [showCalendar, setShowCalendar] = useState(false)

// æ·»åŠ åˆ‡æ¢æ—¥å†è§†å›¾çš„å¤„ç†
const handleViewChange = (view: ViewType) => {
  setCurrentView(view)
  setShowCalendar(view === 'calendar')
}

// åœ¨æ¸²æŸ“éƒ¨åˆ†ï¼Œæ ¹æ® showCalendar åˆ‡æ¢æ˜¾ç¤º
{showCalendar ? (
  <CalendarView
    onSelectNote={handleSelectNote}
    onCreateNote={handleCreateNote}
  />
) : (
  <>
    <NoteList ... />
    <MainContent ... />
  </>
)}
```

### 2. æ›´æ–° Sidebar å¯¼èˆª

åœ¨ [`src/components/layout/Sidebar.tsx`](src/components/layout/Sidebar.tsx) ä¸­æ·»åŠ æ—¥å†å…¥å£ï¼š

```typescript
import { Calendar } from 'lucide-react'

// åœ¨å¯¼èˆªé¡¹ä¸­æ·»åŠ 
<SidebarItem
  icon={Calendar}
  label="æ—¥å†"
  isActive={currentView === 'calendar'}
  onClick={() => onViewChange('calendar')}
/>
```

### 3. å¯¼å‡ºç»„ä»¶

åˆ›å»º `src/components/calendar/index.ts`ï¼š

```typescript
export { CalendarView } from './CalendarView'
export { CalendarHeader } from './CalendarHeader'
export { MonthView } from './MonthView'
export { WeekView } from './WeekView'
export { DayView } from './DayView'
export { CalendarCell } from './CalendarCell'
```

æ›´æ–° `src/hooks/index.ts`ï¼š

```typescript
export { useCalendar } from './useCalendar'
export type { CalendarView, DateField } from './useCalendar'
```

---

## ğŸ“Š å®ç°æµç¨‹å›¾

```mermaid
graph TB
    A[ç”¨æˆ·ç‚¹å‡»æ—¥å†è§†å›¾] --> B[åˆ‡æ¢åˆ° CalendarView ç»„ä»¶]
    B --> C[useCalendar Hook åˆå§‹åŒ–]
    C --> D[è®¡ç®—æ—¥æœŸèŒƒå›´]
    D --> E[æŸ¥è¯¢ IndexedDB]
    E --> F[useLiveQuery å®æ—¶ç›‘å¬]
    F --> G[è®¡ç®—ç¬”è®°åˆ†å¸ƒ]
    G --> H{é€‰æ‹©è§†å›¾æ¨¡å¼}
    H -->|æœˆè§†å›¾| I[MonthView æ¸²æŸ“æ—¥å†ç½‘æ ¼]
    H -->|å‘¨è§†å›¾| J[WeekView æ¸²æŸ“å‘¨åˆ—è¡¨]
    H -->|æ—¥è§†å›¾| K[DayView æ¸²æŸ“æ—¥ç¬”è®°]
    I --> L[ç”¨æˆ·äº¤äº’]
    J --> L
    K --> L
    L -->|ç‚¹å‡»æ—¥æœŸ| M[åˆ‡æ¢åˆ°è¯¥æ—¥æœŸ]
    L -->|ç‚¹å‡»ç¬”è®°| N[æ‰“å¼€ç¬”è®°ç¼–è¾‘å™¨]
    L -->|åˆ›å»ºç¬”è®°| O[åˆ›å»ºå¸¦æ—¥æœŸçš„æ–°ç¬”è®°]
    M --> D
    N --> P[è¿”å›ä¸»ç¼–è¾‘ç•Œé¢]
    O --> P
```

---

## âœ¨ é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### 1. çƒ­åŠ›å›¾è§†å›¾

æ˜¾ç¤ºç¬”è®°æ´»è·ƒåº¦çš„çƒ­åŠ›å›¾ï¼Œç±»ä¼¼ GitHub è´¡çŒ®å›¾ï¼š

```typescript
// åœ¨ MonthView ä¸­æ·»åŠ çƒ­åŠ›å›¾æ¨¡å¼
const getHeatColor = (count: number) => {
  if (count === 0) return 'bg-slate-100 dark:bg-white/[0.03]'
  if (count <= 2) return 'bg-[#5E6AD2]/20'
  if (count <= 5) return 'bg-[#5E6AD2]/40'
  if (count <= 10) return 'bg-[#5E6AD2]/60'
  return 'bg-[#5E6AD2]/80'
}
```

### 2. ç¬”è®°æ‹–æ‹½

å…è®¸ç”¨æˆ·æ‹–æ‹½ç¬”è®°åˆ°ä¸åŒæ—¥æœŸï¼š

```typescript
// ä½¿ç”¨ @dnd-kit åº“å®ç°æ‹–æ‹½
import { DndContext, useDraggable, useDroppable } from '@dnd-kit/core'

// åœ¨æ‹–æ‹½ç»“æŸæ—¶æ›´æ–°ç¬”è®°çš„ createdAt
const handleDragEnd = async (event) => {
  const { active, over } = event
  if (over) {
    await noteOperations.update(active.id, {
      createdAt: over.data.date
    })
  }
}
```

### 3. æ—¥å†å¯¼å‡º

å¯¼å‡ºæ—¥å†è§†å›¾ä¸ºå›¾ç‰‡æˆ– PDFï¼š

```typescript
import html2canvas from 'html2canvas'
import jsPDF from 'jspdf'

const exportCalendar = async () => {
  const element = document.getElementById('calendar-view')
  const canvas = await html2canvas(element)
  const pdf = new jsPDF()
  pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297)
  pdf.save('calendar.pdf')
}
```

### 4. æ—¥å†æé†’

ä¸ºç‰¹å®šæ—¥æœŸè®¾ç½®æé†’ï¼š

```typescript
// æ‰©å±• Note æ¥å£
interface Note {
  // ... ç°æœ‰å­—æ®µ
  reminderDate?: Date
  reminderEnabled?: boolean
}

// ä½¿ç”¨ Web Notifications API
if (Notification.permission === 'granted') {
  new Notification('ç¬”è®°æé†’', {
    body: note.title,
    icon: '/app-icon.png'
  })
}
```

---

## ğŸ¯ å®ç°ä¼˜å…ˆçº§

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰
- [x] æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•
- [x] useCalendar Hook
- [x] CalendarView ä¸»ç»„ä»¶
- [x] CalendarHeader å¯¼èˆª
- [x] MonthView æœˆè§†å›¾
- [x] CalendarCell æ—¥æœŸæ ¼å­
- [x] é›†æˆåˆ° Sidebar

### Phase 2: å¢å¼ºåŠŸèƒ½
- [x] WeekView å‘¨è§†å›¾
- [x] DayView æ—¥è§†å›¾
- [x] æ—¶é—´å­—æ®µåˆ‡æ¢ï¼ˆåˆ›å»º/ä¿®æ”¹ï¼‰
- [x] å¿«é€Ÿåˆ›å»ºç¬”è®°

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- [ ] çƒ­åŠ›å›¾è§†å›¾
- [ ] ç¬”è®°æ‹–æ‹½
- [ ] æ—¥å†å¯¼å‡º
- [ ] æ—¥å†æé†’

---

## ğŸš€ å¼€å‘å»ºè®®

1. **å…ˆå®ç°æœˆè§†å›¾**ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„è§†å›¾ï¼Œä¼˜å…ˆå®Œæˆ
2. **ä½¿ç”¨ç°æœ‰è®¾è®¡ç³»ç»Ÿ**ï¼šä¿æŒä¸ JD Notes çš„ Linear é£æ ¼ä¸€è‡´
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤æ¸²æŸ“
4. **å“åº”å¼è®¾è®¡**ï¼šç¡®ä¿åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½èƒ½è‰¯å¥½æ˜¾ç¤º
5. **æ¸è¿›å¢å¼º**ï¼šå…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œå†é€æ­¥æ·»åŠ é«˜çº§ç‰¹æ€§

---

## ğŸ“ æ€»ç»“

æ—¥å†è§†å›¾åŠŸèƒ½å°†ä¸º JD Notes æä¾›å…¨æ–°çš„æ—¶é—´ç»´åº¦ç¬”è®°ç®¡ç†æ–¹å¼ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿï¼š

- ğŸ“… æŒ‰æ—¥æœŸæµè§ˆå’Œç»„ç»‡ç¬”è®°
- ğŸ“Š å¯è§†åŒ–ç¬”è®°åˆ›å»ºæ´»è·ƒåº¦
- âš¡ å¿«é€Ÿå®šä½ç‰¹å®šæ—¥æœŸçš„ç¬”è®°
- ğŸ¯ æ›´å¥½åœ°è¿›è¡Œæ—¶é—´ç®¡ç†å’Œå›é¡¾

è¯¥è®¾è®¡æ–¹æ¡ˆå®Œå…¨åŸºäºç°æœ‰æŠ€æœ¯æ ˆï¼Œæ— éœ€å¼•å…¥æ–°çš„ä¾èµ–ï¼Œå¯ä»¥æ— ç¼é›†æˆåˆ°å½“å‰åº”ç”¨ä¸­ã€‚