# Role
React & Data Architect.

# Context
We are upgrading the Side Navigation logic.
Currently, "Favorites" and "Trash" in the Sidebar are static UI elements.
We need to implement the actual logic using Dexie.js.

# Goal
1. Add `isFavorite` and `isDeleted` fields to the database.
2. Implement "Soft Delete" (Move to Trash).
3. Implement "Filter Views" (Inbox vs Favorites vs Trash).

# Requirements

## 1. Database Schema Update (`db.ts`)
- **Version Upgrade:** Update the Dexie store definition.
- **Fields:** Add `isFavorite` (0 or 1, mapped to boolean) and `isDeleted` (0 or 1) to the `notes` table.
- **Note:** Dexie handles schema upgrades gracefully, but ensure the new fields are indexed if we plan to query them often.

## 2. App State: "Current View"
- In `App.tsx`, create a state `currentView`: `'inbox' | 'favorites' | 'trash'`.
- Default to `'inbox'`.
- Wire up the Sidebar buttons to update this state.

## 3. Query Logic (The Filter)
- Update the `useLiveQuery` logic to respect `currentView`:
  - **Inbox:** Show notes where `isDeleted === 0`. (Optional: hide favorites from inbox if you prefer, usually Inbox shows all non-deleted).
  - **Favorites:** Show notes where `isFavorite === 1` AND `isDeleted === 0`.
  - **Trash:** Show notes where `isDeleted === 1`.

## 4. UI Actions (Context Menu or Buttons)
- **Editor Header:** Add a "Star" (toggle favorite) button next to the title.
- **Delete Action:**
  - If in Inbox/Favorites: Set `isDeleted = 1` (Move to Trash).
  - If in Trash: Show "Delete Permanently" and "Restore".
- **Sidebar Count:** (Optional) Show a badge count for Favorites/Trash if easy to implement.

# Deliverables
1. Updated `db.ts` schema.
2. Updated `App.tsx` with the `currentView` state and filtered query logic.
3. Updated UI components (Star icon in Editor, Delete button logic).

# Critical UX Detail
- When a note is "Soft Deleted", it should disappear from the "Inbox" list immediately.
- If the *currently active note* is deleted, switch the selection to the next available note or show Empty State.