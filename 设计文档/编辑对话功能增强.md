# Role
Senior Frontend & Logic Architect (React, Dexie.js).

# Goal
Refactor the "Edit Message" feature in the AI Chat Sidebar to act as a "Resend" trigger. 
The UX should be: Click Edit -> Modify -> Press Enter -> Update & Truncate History -> Re-generate AI Response.

# Core Logic Requirements (Strict)

## 1. Edit Mode Behavior (ChatMessageItem)
- When a user message enters "Edit Mode", show a `<textarea>` instead of the text.
- **Keyboard Listener**: 
  - **Press Enter (without Shift)**: Trigger `onSaveAndResend`.
  - **Press Shift + Enter**: Normal line break in textarea.
  - **Press Esc**: Cancel editing.
- **Auto-Focus**: The textarea should automatically focus and select all text when entering edit mode.

## 2. Truncation & Resend Logic (Parent/Sidebar Logic)
Implement an `handleEditAndResend` function that performs these steps in order:
1. **Truncation**: Delete from Dexie DB all messages with an `id` GREATER than the message being edited (for the current `noteId`).
2. **Update**: Update the content of the target message (the one being edited) in the DB.
3. **Re-trigger AI**: Immediately call the AI streaming function using the newly updated message history as the context.

## 3. UI/UX Refinement
- **Visual Feedback**: When Enter is pressed, the textarea should disappear, the message should update, and the "AI is typing..." indicator should appear immediately below it.
- **Loading State**: Disable the "Edit" button while any AI response is currently streaming to prevent race conditions.

## 4. Helper Implementation
- Ensure `useLiveQuery` from Dexie correctly picks up the truncation and updates the UI list instantly.
- Ensure the scrolling logic snaps to the bottom once the new AI stream starts.

# Deliverables
1. Updated `ChatMessageItem.tsx` with the `onKeyDown` and `onSaveAndResend` logic.
2. The logic inside `AIChatSidebar.tsx` that handles the database truncation and re-starts the AI stream.
3. CSS for the seamless transition from "Edit Textarea" to "Normal Message".

# Key Detail for the AI
Explain to the AI that "Deleting newer messages" is crucial to keep the conversation history consistent, so the AI doesn't see "future" messages that no longer make sense given the edited prompt.